webpackJsonp([5],{"1BRe":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("3cXf"),s=r.n(n),a=r("0Njg"),i=r("R2SV"),o=r("LLxk"),l={data:function(){return{width:1e3,height:600,title:"新增用例",disabled:!1,functionListApi:a.A,id:this.$route.params.id,packageId:null,form:{name:null,workflow:null},owner:!0,presetParams:[]}},computed:{},methods:{addPresetParams:function(){this.presetParams.push({key:"",value:"",type:"text"}),console.log(this.presetParams)},save:function(){var e=this;this.$refs.edit.validate(function(t){if(t){var r=e.$refs.workflow.validate();r.result?e.$confirm((e.owner?"":"你即将复制并保存此用例到自己的用例列表中，")+"确定保存吗？","提示",{type:"info"}).then(function(){e.disabled=!0,e.id&&e.owner?Object(a._21)(e.id,e.generateParams()).then(function(t){e.$transfer({back:"再次编辑",buttons:[{text:"去列表",link:"/flow/testCase"}]})}).catch(function(){e.disabled=!1}):Object(a.l)(e.generateParams()).then(function(t){window.history.replaceState(null,document.title,"/#/flow/testCase/edit/"+t),e.$transfer({back:"继续添加",buttons:[{text:"去列表",link:"/flow/testCase"}]})}).catch(function(){e.disabled=!1})}):e.$message({message:r.message,type:"warning"})}else e.$message({message:"请输入用例名称",type:"warning"})})},generateParams:function(){return{workflow:s()(this.$refs.workflow.workflow()),name:this.form.name,presetParams:s()(this.presetParams),packageId:this.packageId}},test:function(){var e=this,t=this.$refs.workflow.validate();if(t.result){this.$refs.runnerDialog.open();var r={workflow:this.$refs.workflow.workflow(),presetParams:this.presetParams};setTimeout(function(){return e.$refs.runner.setData(r)},500)}else this.$message({message:t.message,type:"warning"})},runTest:function(){this.$refs.runner.run(1)},beautify:function(){this.$refs.workflow.beautify()},loadMultipleInterfaces:function(e){var t=this;Object(a.T)({rows:1e3,idList:e}).then(function(e){e&&e.length>0&&t.$refs.workflow.batchAddNodes(e),t.disabled=!1})},openBatchImportDialog:function(){this.$refs.chooseInterfacesDialog.open()},batchImport:function(){var e=this.$refs.interfacesList.getSelections();console.log(e),0!==e.length?(this.$refs.workflow.batchAddNodes(e),this.$refs.interfacesList.clearSelections(),this.$refs.chooseInterfacesDialog.close()):this.$alert("请至少选择一个接口","提示",{type:"error"})}},mounted:function(){var e=this;window.that1=this;var t=Object(i.f)().packageId;t?(this.form.workflow={},this.disabled=!0,this.packageId=t,Object(a.L)(t).then(function(t){e.form.name=t.name,setTimeout(function(){e.loadMultipleInterfaces(t.interfacesIdList)},800)})):this.id?(this.owner=!1,this.title="修改用例",Object(a.O)(this.id).then(function(t){e.form.name=t.name,e.form.workflow=JSON.parse(t.workflow),e.presetParams=JSON.parse(t.presetParams),e.owner=t.userName===Object(o.e)()}).catch(function(e){console.log(e)})):this.$set(this.form,"workflow",{})},components:{"v-runner":function(){return r.e(34).then(r.bind(null,"V7zm"))},"v-selector":function(){return r.e(30).then(r.bind(null,"qNHp"))},"v-workflow":function(){return r.e(42).then(r.bind(null,"2fbX"))},"v-parameter-input":function(){return r.e(36).then(r.bind(null,"WfCw"))},"v-dialog":function(){return r.e(31).then(r.bind(null,"j9Pd"))},"v-interfaces-list":function(){return r.e(1).then(r.bind(null,"vKqz"))}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h4",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),r("hr"),e._v(" "),r("el-form",{ref:"edit",staticStyle:{"max-width":"1100px"},attrs:{model:e.form,"label-width":"8em"}},[r("el-form-item",{attrs:{label:"用例名称:",prop:"name",required:"",rules:[{required:!0,message:"请输入用例名称",trigger:["blur","change"]}]}},[r("el-input",{attrs:{placeholder:"请输入用例名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"预置参数:"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(t){return e.addPresetParams()}}}),e._v("\n      在后续脚本中使用，如设置了参数名为：name=value，使用 $name 即可获得此参数对应的值value，不要重复命名\n      "),r("v-parameter-input",{attrs:{parameters:e.presetParams,"need-add-params":!1}})],1),e._v(" "),r("el-form-item",{attrs:{label:"配置流程:","label-width":"8em"}},[r("div",{staticClass:"testcase_editor_container",style:{width:e.width+2+"px"}},[e.form.workflow?r("v-workflow",{ref:"workflow",attrs:{"data-list":e.form.workflow,width:e.width,height:e.height}}):e._e()],1)]),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"info",icon:"el-icon-back"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),e._v(" "),r("el-button",{attrs:{type:"primary",icon:e.disabled?"el-icon-loading":"el-icon-success",disabled:e.disabled},on:{click:e.save}},[e._v("保存")]),e._v(" "),r("el-button",{attrs:{type:"primary",icon:"el-icon-upload2"},on:{click:e.openBatchImportDialog}},[e._v("批量导入接口")]),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-s-grid"},on:{click:e.beautify}},[e._v("美化")]),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-magic-stick"},on:{click:e.test}},[e._v("测试")])],1)],1),e._v(" "),r("v-dialog",{ref:"runnerDialog",attrs:{title:"运行用例","ok-text":"开始执行","cancel-text":"关闭",ok:e.runTest,width:1300}},[r("div",{attrs:{slot:"body"},slot:"body"},[r("v-runner",{ref:"runner",attrs:{width:1100,height:518}})],1)]),e._v(" "),r("v-dialog",{ref:"chooseInterfacesDialog",attrs:{title:"选择接口",ok:e.batchImport,width:1300}},[r("div",{staticStyle:{height:"600px",overflow:"auto"},attrs:{slot:"body"},slot:"body"},[r("v-interfaces-list",{ref:"interfacesList",attrs:{"no-toolbar":!0}})],1)])],1)},staticRenderFns:[]};var f=r("C7Lr")(l,c,!1,function(e){r("nAot")},"data-v-22f185dc",null);t.default=f.exports},nAot:function(e,t){}});
//# sourceMappingURL=5.a370913f15ef8f3a4570.js.map