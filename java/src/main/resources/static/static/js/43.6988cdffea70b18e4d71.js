webpackJsonp([43],{nSD5:function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return s});var o=n("Q+Ik"),i=n.n(o),l=n("rVsN"),a=n.n(l),r={1:{name:"订单主表",schema:"order"},2:{name:"订单商品主表",schema:"order"},3:{name:"商品主表",schema:"order"},4:{name:"优惠券主表",schema:"order"}},c=function(e){return a.a.resolve(i()(r).map(function(e){return{id:+e[0],name:e[1].name}}))},s=function(e){return a.a.resolve({columns:[{name:"字段1",column:"column1",type:"类型",comment:"备注"+Date.now()},{name:"字段2",column:"column2",type:"类型",comment:"备注"+Date.now()},{name:"字段3",column:"column3",type:"类型",comment:"备注"+Date.now()},{name:"字段4",column:"column4",type:"类型",comment:"备注"+Date.now()}],id:e,name:r[e].name,description:"主表，相关的数据"})}},xiMG:function(e,t){},xxNE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("aA9S"),i=n.n(o),l=n("lC5x"),a=n.n(l),r=n("J0Oq"),c=n.n(r),s=n("nSD5"),u={props:{onOk:{type:Function,default:function(){}}},data:function(){return{library:"publics",tableListApi:s.b,tableInfoApi:s.a,tableInfo:null,aggregationDataList:[],fixedColumns:[],customColumns:[],joinTypeList:[],conditionList:[],columns:[{field:"name",header:"字段名",width:100},{field:"type",header:"类型",width:100},{field:"comment",header:"说明",width:300},{field:"action",header:"操作",width:80,html:!0,actions:[{text:"【删除】",handler:function(e){}}]}],node:{aggregation:!1,tableId:null}}},methods:{onSelectCustomColumn:function(){},onLibraryClicked:function(){},addCustomColumn:function(){this.customColumns.push({})},deleteCustomColumn:function(e){this.customColumns.splice(e,1)},addJoinType:function(){this.joinTypeList.push({})},deleteJoinType:function(e){this.joinTypeList.splice(e,1)},addCondition:function(){this.conditionList.push({})},deleteCondition:function(e){this.conditionList.splice(e,1)},onSelectAggregation:function(e){console.log(e),this.fixedColumns=e.map(function(e){return e})},onSelectTable:function(e){var t=this;return c()(a.a.mark(function n(){var o;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:o=e[0]||{},t.node.tableId=o.id,t.node.name=o.name,Object(s.a)(t.node.tableId).then(function(e){t.tableInfo=e});case 4:case"end":return n.stop()}},n,t)}))()},setInterfaces:function(e){},open:function(e){this.n=e;var t=e.getModel();console.log(e.getEdges()),console.log(t),this.aggregationDataList=e.getEdges().map(function(e){return e.getSource()}).filter(function(t){return t!==e}).map(function(e){var t=e.getModel().data;return t&&(t.columns=t.columns.map(function(e){return e.text=t.name+"."+e.name,e})),t}).filter(function(e){return e}).flatMap(function(e){return e.columns}),console.log(this.aggregationDataList),0!==this.aggregationDataList.length?(console.log(this.aggregationDataList),this.$refs.editNodeDialog.open()):this.$alert("请先设置接入表！","提示",{type:"error"})},confirm:function(){var e=this;this.$refs.form.validate(function(t){t&&(e.onOk&&e.onOk(i()({},e.node)),e.$refs.editNodeDialog.close())})}},mounted:function(){window.tt=this},components:{"v-dialog":function(){return n.e(31).then(n.bind(null,"j9Pd"))},"v-selector":function(){return n.e(30).then(n.bind(null,"qNHp"))},"v-datagrid":function(){return n.e(32).then(n.bind(null,"mW4C"))}}},d={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{ref:"editNodeDialog",attrs:{title:"组合表",ok:e.confirm,width:1e3}},[n("div",{attrs:{slot:"body"},slot:"body"},[n("el-form",{ref:"form",staticClass:"edit-node-dialog",attrs:{model:e.node,"label-width":"8em"}},[n("el-form-item",{attrs:{prop:"aggregation",label:"聚合："}},[n("el-switch",{model:{value:e.node.aggregation,callback:function(t){e.$set(e.node,"aggregation",t)},expression:"node.aggregation"}})],1),e._v(" "),e.node.aggregation?n("el-form-item",{attrs:{label:"聚合维度:",required:"",rules:[{required:!0,message:"请至少选择一个聚合维度",trigger:["blur","change"]}]}},[e.aggregationDataList.length>0?n("v-selector",{staticStyle:{width:"666px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectAggregation,multiple:!0,filterable:!0,placeholder:"请选择聚合维度",load:e.node.tableId?[e.node.tableId]:null,data:e.aggregationDataList}}):e._e()],1):e._e(),e._v(" "),e.node.aggregation?n("el-form-item",{attrs:{prop:"tableId",label:"数据指标:",required:"",rules:[{required:!0,message:"请选择一个表",trigger:["blur","change"]}]}},[n("el-form",[e._l(e.fixedColumns,function(t,o){return n("el-form-item",{key:"fixedColumns_"+o},[n("div",[e._v(e._s(t.text))])])}),e._v(" "),e.customColumns?n("el-form",[e._l(e.customColumns,function(t,o){return n("el-form-item",{key:"customColumns_"+o},[n("v-selector",{staticStyle:{width:"200px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectCustomColumn,filterable:!0,placeholder:"请选择需要的指标",load:t.column?[t.column]:null,data:e.aggregationDataList}}),e._v(" "),n("v-selector",{staticStyle:{width:"100px"},attrs:{placeholder:"选择转换算法",load:t.column?[t.column]:["不转换"],data:[{id:"不转换",text:"不转换"},{id:"转换",text:"转换"},{id:"聚合",text:"聚合"}]}}),e._v(" "),n("v-selector",{staticStyle:{width:"100px"},attrs:{onSelectionChanged:e.onSelectCustomColumn,placeholder:"选择转换算法",load:t.mapper?[t.mapper]:["算法1"],data:[{id:"算法1",text:"算法1"},{id:"算法2",text:"算法2"},{id:"算法3",text:"算法3"}]}}),e._v(" "),n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small"},on:{click:function(t){return e.deleteCustomColumn(o)}}})],1)}),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(t){return e.addCustomColumn()}}})],1)],2):e._e()],2)],1):e._e(),e._v(" "),e.node.aggregation?n("el-form-item",{attrs:{label:"连接:",required:"",rules:[{required:!0,message:"请至少选择一个聚合维度",trigger:["blur","change"]}]}},[e.joinTypeList?n("el-form",[e._l(e.joinTypeList,function(t,o){return n("el-form-item",{key:"joinTypeList_"+o},[n("v-selector",{staticStyle:{width:"200px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectCustomColumn,filterable:!0,placeholder:"请选择需要的指标",load:t.leftColumn?[t.leftColumn]:null,data:e.aggregationDataList}}),e._v(" "),n("v-selector",{staticStyle:{width:"200px"},attrs:{onSelectionChanged:e.onSelectCustomColumn,placeholder:"选择连接方式",load:t.joinType?[t.joinType]:null,data:[{id:"内联",text:"内联"},{id:"左联",text:"左联"}]}}),e._v(" "),n("v-selector",{staticStyle:{width:"200px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectCustomColumn,filterable:!0,placeholder:"请选择需要的指标",load:t.rightColumn?[t.rightColumn]:null,data:e.aggregationDataList}}),e._v(" "),n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small"},on:{click:function(n){return e.deleteJoinType(t)}}})],1)}),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(t){return e.addJoinType()}}})],1)],2):e._e()],1):e._e(),e._v(" "),e.node.aggregation?n("el-form-item",{attrs:{label:"条件:",required:"",rules:[{required:!0,message:"请至少选择一个聚合维度",trigger:["blur","change"]}]}},[e.conditionList?n("el-form",[e._l(e.conditionList,function(t,o){return n("el-form-item",{key:"conditionList_"+o},[n("v-selector",{staticStyle:{width:"200px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectCustomColumn,filterable:!0,placeholder:"请选择需要的指标",load:t.leftColumn?[t.leftColumn]:null,data:e.aggregationDataList}}),e._v(" "),n("v-selector",{staticStyle:{width:"200px"},attrs:{onSelectionChanged:e.onSelectCustomColumn,placeholder:"选择连接方式",load:t.joinType?[t.joinType]:null,data:[{id:">",text:">"},{id:"=",text:"="},{id:"<",text:"<"},{id:"in",text:"in"}]}}),e._v(" "),n("v-selector",{staticStyle:{width:"200px"},attrs:{id:"column",text:"text",searchKey:"name",onSelectionChanged:e.onSelectCustomColumn,filterable:!0,placeholder:"请选择需要的指标",load:t.rightColumn?[t.rightColumn]:null,data:e.aggregationDataList}}),e._v(" "),n("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"small"},on:{click:function(n){return e.deleteCondition(t)}}})],1)}),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(t){return e.addCondition()}}})],1)],2):e._e()],1):e._e()],1)],1)])],1)},staticRenderFns:[]};var m=n("C7Lr")(u,d,!1,function(e){n("xiMG")},"data-v-3bb18bfc",null);t.default=m.exports}});
//# sourceMappingURL=43.6988cdffea70b18e4d71.js.map